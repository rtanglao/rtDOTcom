I"z<p><a href="https://github.com/rtanglao/rtgram/commit/92a58561d583563559ef0cd9018c552dce590b53#diff-7bb9d9fb060d2d3ad8f4588659887d3d">Update and insert all in one go</a>! (I’m sure this worked with ruby mongo driver version 1. I just didn’t realize it until I read <a href="http://stackoverflow.com/questions/30772689/i-could-not-push-an-new-data-into-array-when-use-upsert">this stackoverflow question on upsert</a>). Here’s the relevant code snippet (“id” is the instagram string unique id not to be confused with mongo’s unique id which is “_id”):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">photosColl</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span> <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nb">id</span> <span class="p">}).</span><span class="nf">update_one</span><span class="p">(</span><span class="n">photo</span><span class="p">,</span><span class="ss">:upsert</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">)</span>    
</code></pre></div></div>
:ET